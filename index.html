<!DOCTYPE html>
<html>
	<head>
		<script src="//treetopflyer.github.com/vcore/lib.js"></script>
	</head>
	<body>

		<script>
			
			var RBM = {};
			RBM.Bool = function(inMatrix)
			{
				var i, j;
				var rand;
				var outM = [];
				for(i=0; i<inMatrix.length; i++)
				{
					var outV = []
					for(j=0; j<inMatrix[i].length; j++)
					{
						rand = Math.random();
						if(rand < inMatrix[i][j])
						{
							outV[j] = 1;
						}
						else
						{
							outV[j] = 0;
						}
					}
					outM.push(outV);
				}
				return outM;
			};
			RBM.Create = function(inDimensionsIn, inDimensionsOut)
			{
				var obj = {};
				var min = [];
				var max = [];
				var i;
				for(i=0; i<inDimensionsIn; i++)
				{
					min.push(-0.5);
					max.push(0.5);
				}
				
				obj.MatrixForward = M.Box([min, max], inDimensionsOut);
				obj.MatrixBackward = M.Transpose(obj.MatrixForward);
				
				return obj;
			};
            RBM.Out = function(inRBM, inData)
            {
                affine = M.Transform(inRBM.MatrixForward, inData);
                return M.Sigmoid(affine);
            };
            RBM.Back = function(inRBM, inData)
            {
                affine = M.Transform(inRBM.MatrixBackward, inData);
                return M.Sigmoid(affine);
            };
            RBM.Adjust = function(inRBM, inPos, inNeg, inRate)
            {
                inRBM.MatrixForward = M.Add(inRBM.MatrixForward, M.Scale(inPos, inRate));
                inRBM.MatrixForward = M.Subtract(inRBM.MatrixForward, M.Scale(inNeg, inRate));
                inRBM.MatrixBackward = M.Transpose(inRBM.MatrixForward);  
            };
			RBM.Train = function(inRBM, inData, inRate)
			{
                pass1 = RBM.Out(inRBM, inData);
                pass2 = RBM.Back(inRBM, pass1);
                pass3 = RBM.Out(inRBM, pass2);
                
                var pos = M.Outer(inData[0], pass1[0]);
                var neg = M.Outer(inData[0], pass3[0])
                
                RBM.Adjust(inRBM, pos, neg, inRate);
			};
            RBM.Observe = function(inRBM, inData)
			{
                return RBM.Back( inRBM, RBM.Out(inRBM, inData) );
			};
            RBM.ObserveN = function(inRBM, inData, inIterations)
			{
                var obs = inData;
                var i;
                for(i=0; i<inIteratgit ions; i++)
                {
                    obs = RBM.Back( inRBM, RBM.Out(inRBM, obs) );
                }
                return obs;
			};
			

            var trainingSet = [[0, 0, 1, 1, 0, 0]];
			var rbm1 = RBM.Create(6, 100);
			
            var i;
            for(i=0; i<100; i++)
            {
               RBM.Train(rbm1, [[0, 0, 1, 1, 0, 0]], 0.1); 
               RBM.Train(rbm1, [[1, 0, 0, 0, 1, 0]], 0.1); 
            }
			
			//console.log( RBM.Observe(rbm1, trainingSet) );
			
		</script>
	</body>
</html>