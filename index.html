<!DOCTYPE html>
<html>
	<head>
		<script src="//treetopflyer.github.com/vcore/lib.js"></script>
	</head>
	<body>

		<script>
			
			var RBM = {};
			RBM.Create = function(inDimensionsIn, inDimensionsOut)
			{
				var obj = {};
				var min = [];
				var max = [];
				var i;
				for(i=0; i<inDimensionsIn; i++)
				{
					min.push(-0.5);
					max.push(0.5);
				}
				
				obj.MatrixForward = M.Box([min, max], inDimensionsOut);
				obj.MatrixBackward = M.Transpose(obj.MatrixForward);
				
				return obj;
			};
            RBM.Out = function(inRBM, inData)
            {
                return M.Sigmoid(M.Transform(inRBM.MatrixForward, inData));
            };
            RBM.Back = function(inRBM, inData)
            {
                return M.Sigmoid(M.Transform(inRBM.MatrixBackward, inData));
            };
			RBM.Train = function(inRBM, inData, inRate)
			{
                pass1 = RBM.Out(inRBM, inData);
                pass2 = RBM.Back(inRBM, pass1);
                pass3 = RBM.Out(inRBM, pass2);
                
                var pos;
                var neg;
                var i;
                for(i=0; i<inData.length; i++)
                {
                    pos = M.Outer(inData[i], pass1[i]);
                    neg = M.Outer(inData[i], pass3[i]);
                    inRBM.MatrixForward = M.Add(inRBM.MatrixForward, M.Scale(pos, inRate));
                    inRBM.MatrixForward = M.Subtract(inRBM.MatrixForward, M.Scale(neg, inRate));
                }
                
                inRBM.MatrixBackward = M.Transpose(inRBM.MatrixForward);  
			};
            RBM.Observe = function(inRBM, inData)
			{
                return RBM.Back( inRBM, RBM.Out(inRBM, inData) );
			};
            RBM.ObserveN = function(inRBM, inData, inIterations)
            {
                var i;
                var obs = inData;
                for(i=0; i<inIterations; i++)
                {
                    obs = RBM.Observe(inRBM, obs);  
                }
                return obs;
            };
			

            var trainingSet = [];
            trainingSet.push([0, 0, 1, 1, 0, 0, 0, 0]);
            trainingSet.push([1, 0, 0, 0, 0, 1, 0, 0]);
            trainingSet.push([1, 0, 0, 0, 0, 1, 1, 1]);
            
			var rbm1 = RBM.Create(8, 1000);
            var i;
            for(i=0; i<1000; i++)
            {
               RBM.Train(rbm1, trainingSet, 0.1); 
            }
			
			//console.log( RBM.Observe(rbm1, trainingSet) );
			
		</script>
	</body>
</html>